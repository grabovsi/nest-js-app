pipeline {
     agent any
     stages {
        stage("Checkout") {
               steps {
                    git url: 'https://github.com/grabovsi/nest-js-app.git'
               }
        }
        stage("npm install + lint") {
            steps {
                sh "npm install"
                sh "npm run lint"
                }
        }

        stage("Code coverage") {
            steps {
                sh "jest --coverage"
                publishHTML (target: [
                    reportDir: 'coverage/lcov-report',
                    reportFiles: 'index.html',
                    reportName: "Jest test coverage report"
                ])

        }
}

        stage("unit tests") {
            steps {
                sh "npm run test"
                }
        }  
        stage("e2e tests") {
            steps {
                sh "npm run test:e2e"
                }
        }      
        stage('Second Stage') {
               steps {
                    sh 'echo "Hello World from build $BUILD_NUMBER"'
                    sh 'ls'
                    echo 'Step 3. Third time Hello'
               }
        }
     }
}